# 多平台内容发布工具 - 产品文档

## 一、项目概述

本项目是一个基于 Python 和 Playwright 的多平台内容自动发布工具，支持将文章一键发布到微信公众号、头条号、小红书等主流自媒体平台。同时集成 AI 内容生成功能，可根据主题自动生成标题和正文。

---

## 二、核心功能

### 2.1 多平台发布
| 平台 | 状态 | 说明 |
|------|------|------|
| 微信公众号 | ✅ 已实现 | 支持图文发布、封面上传、摘要填写 |
| 头条号 | ✅ 已实现 | 支持文章发布、自动选择无封面 |
| 小红书 | 🚧 基础实现 | 支持图文笔记发布 |

### 2.2 AI 内容生成
- **模型**：通义千问 (qwen3-max)
- **功能**：根据输入的主题自动生成吸引人的标题和 800-1500 字的正文
- **输出格式**：结构清晰、分段落、适合大众阅读

### 2.3 登录状态管理
- 自动保存各平台的登录状态（Cookies）
- 下次启动时自动加载，无需重复登录
- 登录状态存储在 `auth_states/` 目录下

### 2.4 双入口模式
- **命令行模式**：通过 `main.py` 运行
- **Web 界面模式**：通过 `app.py` 启动 Flask 服务，浏览器访问

---

## 三、技术架构

```
publish_tools/
├── main.py                 # 命令行入口
├── app.py                  # Web 服务入口 (Flask)
├── requirements.txt        # 依赖包列表
├── platforms/              # 各平台发布模块
│   ├── base.py            # 基类（通用功能）
│   ├── wechat.py          # 微信公众号
│   ├── toutiao.py         # 头条号
│   └── xiaohongshu.py     # 小红书
├── utils/                  # 工具模块
│   ├── auth_manager.py    # 登录状态管理
│   └── content_generator.py # AI 内容生成
├── templates/              # Web 页面模板
│   └── index.html         # 主页面
├── static/                 # 静态资源
└── auth_states/            # 登录状态存储
    ├── wechat.json
    └── toutiao.json
```

### 3.1 技术栈
- **语言**：Python 3.x
- **浏览器自动化**：Playwright
- **Web 框架**：Flask
- **AI 接口**：OpenAI 兼容 API（通义千问）

---

## 四、使用流程

### 4.1 命令行模式

```bash
python main.py
```

**流程：**
1. 选择发布平台（1-微信 / 2-头条 / 3-小红书 / 4-全部）
2. 选择内容来源：
   - AI 生成：输入主题 → 自动生成标题和正文 → 确认或修改
   - 手动输入：直接输入标题和正文
3. 选择是否添加封面图片
4. 自动打开浏览器，执行登录（首次需扫码）
5. 自动填充内容并发布

### 4.2 Web 界面模式

```bash
python app.py
```

**访问地址**：`http://localhost:8080`

**流程：**
1. 在网页上勾选目标平台
2. 输入文章主题
3. 点击"生成内容"，AI 自动生成标题和正文
4. 预览并确认内容
5. 点击"发布"，后台自动执行发布流程

---

## 五、各平台发布详情

### 5.1 微信公众号 (wechat.py)

**登录方式**：扫描二维码

**发布流程**：
1. 访问 `mp.weixin.qq.com`
2. 检测登录状态（通过 URL 中的 token 判断）
3. 进入图文编辑器页面
4. 填充标题（通过 data-placeholder 或 class 定位）
5. 填充正文（通过占位符文本或最大编辑区域定位）
6. 点击"发表"按钮
7. 在发表弹窗中：
   - 上传封面图片
   - 填写摘要
   - 确认发表
8. 处理 AI 声明弹窗（自动点击"无需声明并发表"）

**默认封面**：`/Users/duty/pictures/00000.png`

### 5.2 头条号 (toutiao.py)

**登录方式**：扫描二维码

**发布流程**：
1. 访问 `mp.toutiao.com`
2. 检测登录状态（通过 URL 跳转判断）
3. 进入文章发布页面
4. 填充标题
5. 填充正文（支持多种编辑器定位方式）
6. 自动选择"无封面"选项
7. 点击"预览并发布"按钮
8. 确认发布

### 5.3 小红书 (xiaohongshu.py)

**登录方式**：扫描二维码

**发布流程**：
1. 访问小红书创作者中心
2. 检测登录状态
3. 上传图片（必填）
4. 填充标题和正文
5. 发布

---

## 六、AI 内容生成

### 6.1 配置信息
- **API 地址**：`https://dashscope.aliyuncs.com/compatible-mode/v1`
- **模型**：`qwen3-max`
- **API Key**：`sk-eff2128169cc440db8a76dc084bcc8ab`

### 6.2 生成提示词

```
请根据以下主题，生成一篇适合发布在微信公众号和头条的文章。

主题：{用户输入的主题}

要求：
1. 标题要吸引人，20字以内
2. 正文800-1500字，结构清晰，分段落
3. 内容要有价值，适合大众阅读
4. 语言通俗易懂，避免过于专业的术语

请按以下格式输出：
【标题】
（这里写标题）

【正文】
（这里写正文）
```

---

## 七、安装与运行

### 7.1 安装依赖

```bash
pip install -r requirements.txt
playwright install chromium
```

### 7.2 依赖列表 (requirements.txt)

```
playwright>=1.40.0
openai
flask
flask-cors
```

### 7.3 运行

```bash
# 命令行模式
python main.py

# Web 模式
python app.py
# 然后访问 http://localhost:8080
```

---

## 八、注意事项

1. **首次使用**：各平台需要扫码登录，登录成功后会自动保存状态
2. **登录过期**：如果提示未登录，删除 `auth_states/` 下对应的 JSON 文件重新登录
3. **平台更新**：如果平台页面结构变化，可能需要更新选择器代码
4. **封面图片**：微信公众号需要封面图片，默认使用 `/Users/duty/pictures/00000.png`
5. **网络要求**：需要稳定的网络连接，AI 生成需要访问阿里云 API

---

## 九、调试功能

发布过程中会自动截图保存，便于排查问题：

| 文件名 | 说明 |
|--------|------|
| `wechat_editor.png` | 微信编辑器页面 |
| `wechat_after_fill.png` | 填充内容后 |
| `wechat_publish_dialog.png` | 发表弹窗 |
| `wechat_before_summary.png` | 填写摘要前 |
| `wechat_error.png` | 出错时截图 |
| `toutiao_before_fill.png` | 头条填充前 |
| `toutiao_after_fill.png` | 头条填充后 |
| `toutiao_error.png` | 头条出错截图 |

---

## 十、后续规划

- [ ] 支持更多平台（知乎、百家号、企鹅号等）
- [ ] 支持定时发布
- [ ] 支持批量发布多篇文章
- [ ] 优化 AI 生成质量，支持多种文章风格
- [ ] 添加发布结果通知（邮件/微信）
- [ ] 支持 Markdown 格式内容

---

**文档版本**：v1.0  
**更新日期**：2025-12-18

